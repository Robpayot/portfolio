<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Robin xp Sound</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->
    <link rel="stylesheet" href="stylesheets/styles.css">
</head>

<body>
    <section class="xp">
        <!-- Helper -->
        <section class="jauge">
            <ul class="frequencies">
                <li class="hight">
                    <h1>Hight</h1>
                    <div class="circle"></div>
                </li>
                <li class="medium">
                    <h1>Medium</h1>
                    <div class="circle"></div>
                </li>
                <li class="low">
                    <h1>Low</h1>
                    <div class="circle"></div>
                </li>
            </ul>
        </section>
        <!-- Bars -->
        <section class="graphicBars">
            <canvas class="graphicBars__canvas"></canvas>
            <audio class="audio" controls>
                <!--  // autoplay -->
                <!-- <source src="sounds/hiphop_ldd.mp3" type="audio/ogg"> -->
                <!-- eery_her.mp3
			snailshouse_ra-mu-ne.mp3
			fox_doubleup.mp3
			fluxpav_cracks.mp3
			-->
                <source src="sounds/eery_her.mp3" type="audio/mp3">
                <p>Browser too old to support HTML5 audio? How depressing!</p>
            </audio>
        </section>
        <!-- 3D -->
        <section class="univers">
        </section>
    </section>
    <div class="overlay"></div>
    <!-- // Water stuff -->
	<div id="info" style="display: none;">
		<a href="http://threejs.org/" target="_blank" rel="noopener">three.js</a> - <span id="waterSize">128 x 128</span> webgl gpgpu water<br>
		Select <span id="options"><a href="https://threejs.org/examples/webgl_gpgpu_water.html#" onclick="return change(16)">16x16</a> <a href="https://threejs.org/examples/webgl_gpgpu_water.html#" onclick="return change(32)">32x32</a> <a href="https://threejs.org/examples/webgl_gpgpu_water.html#" onclick="return change(64)">64x64</a> <a href="https://threejs.org/examples/webgl_gpgpu_water.html#" onclick="return change(128)">128x128</a> <a href="https://threejs.org/examples/webgl_gpgpu_water.html#" onclick="return change(256)">256x256</a> <a href="https://threejs.org/examples/webgl_gpgpu_water.html#" onclick="return change(512)">512x512</a> </span> water size<br>
		Move mouse to disturb water.<br>
		Press mouse button to orbit around. 'W' key toggles wireframe.
	</div>
	<!-- This is the 'compute shader' for the water heightmap: -->
	<script id="heightmapFragmentShader" type="x-shader/x-fragment">

		#include <common>

		uniform vec2 mousePos;
		uniform float mouseSize;
		uniform float viscosityConstant;

		#define deltaTime ( 1.0 / 60.0 )
		#define GRAVITY_CONSTANT ( resolution.x * deltaTime * 3.0 )

		void main()	{

			vec2 cellSize = 1.0 / resolution.xy;

			vec2 uv = gl_FragCoord.xy * cellSize;

			// heightmapValue.x == height
			// heightmapValue.y == velocity
			// heightmapValue.z, heightmapValue.w not used
			vec4 heightmapValue = texture2D( heightmap, uv );

			// Get neighbours
			vec4 north = texture2D( heightmap, uv + vec2( 0.0, cellSize.y ) );
			vec4 south = texture2D( heightmap, uv + vec2( 0.0, - cellSize.y ) );
			vec4 east = texture2D( heightmap, uv + vec2( cellSize.x, 0.0 ) );
			vec4 west = texture2D( heightmap, uv + vec2( - cellSize.x, 0.0 ) );

			float sump = north.x + south.x + east.x + west.x - 4.0 * heightmapValue.x;

			float accel = sump * GRAVITY_CONSTANT;

			// Dynamics
			heightmapValue.y += accel;
			heightmapValue.x += heightmapValue.y * deltaTime;

			// Viscosity
			heightmapValue.x += sump * viscosityConstant;

			// Mouse influence
			float mousePhase = clamp( length( ( uv - vec2( 0.5 ) ) * BOUNDS - vec2( mousePos.x, - mousePos.y ) ) * PI / mouseSize, 0.0, PI );
			heightmapValue.x += cos( mousePhase ) + 1.0;

			gl_FragColor = heightmapValue;

		}

	</script>

	<!-- This is just a smoothing 'compute shader' for using manually: -->
	<script id="smoothFragmentShader" type="x-shader/x-fragment">

		uniform sampler2D texture;

		void main()	{

			vec2 cellSize = 1.0 / resolution.xy;

			vec2 uv = gl_FragCoord.xy * cellSize;

			// Computes the mean of texel and 4 neighbours
			vec4 textureValue = texture2D( texture, uv );
			textureValue += texture2D( texture, uv + vec2( 0.0, cellSize.y ) );
			textureValue += texture2D( texture, uv + vec2( 0.0, - cellSize.y ) );
			textureValue += texture2D( texture, uv + vec2( cellSize.x, 0.0 ) );
			textureValue += texture2D( texture, uv + vec2( - cellSize.x, 0.0 ) );

			textureValue /= 5.0;

			gl_FragColor = textureValue;

		}

	</script>

	<!-- This is the water visualization shader, copied from the MeshPhongMaterial and modified: -->
	<script id="waterVertexShader" type="x-shader/x-vertex">

		uniform sampler2D heightmap;

		#define PHONG

		varying vec3 vViewPosition;

		#ifndef FLAT_SHADED

			varying vec3 vNormal;

		#endif

		#include <common>
		#include <uv_pars_vertex>
		#include <uv2_pars_vertex>
		#include <displacementmap_pars_vertex>
		#include <envmap_pars_vertex>
		#include <color_pars_vertex>
		#include <morphtarget_pars_vertex>
		#include <skinning_pars_vertex>
		#include <shadowmap_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		void main() {

			vec2 cellSize = vec2( 1.0 / WIDTH, 1.0 / WIDTH );

			#include <uv_vertex>
			#include <uv2_vertex>
			#include <color_vertex>

			// # include <beginnormal_vertex>
			// Compute normal from heightmap
			vec3 objectNormal = vec3(
				( texture2D( heightmap, uv + vec2( - cellSize.x, 0 ) ).x - texture2D( heightmap, uv + vec2( cellSize.x, 0 ) ).x ) * WIDTH / BOUNDS,
				( texture2D( heightmap, uv + vec2( 0, - cellSize.y ) ).x - texture2D( heightmap, uv + vec2( 0, cellSize.y ) ).x ) * WIDTH / BOUNDS,
				1.0 );
			//<beginnormal_vertex>

			#include <morphnormal_vertex>
			#include <skinbase_vertex>
			#include <skinnormal_vertex>
			#include <defaultnormal_vertex>

		#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED

			vNormal = normalize( transformedNormal );

		#endif

			//# include <begin_vertex>
			float heightValue = texture2D( heightmap, uv ).x;
			vec3 transformed = vec3( position.x, position.y, heightValue );
			//<begin_vertex>

			#include <morphtarget_vertex>
			#include <skinning_vertex>
			#include <displacementmap_vertex>
			#include <project_vertex>
			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>

			vViewPosition = - mvPosition.xyz;

			#include <worldpos_vertex>
			#include <envmap_vertex>
			#include <shadowmap_vertex>

		}

	</script>
    <script src="https://code.createjs.com/preloadjs-0.6.2.min.js"></script>
    <!-- <script src="https://connect.soundcloud.com/sdk/sdk-3.1.2.js"></script> -->
    <script>
    // SC.initialize({
    //     client_id: 'YOUR_CLIENT_ID'
    // });

    // // stream track id 293
    // SC.stream('/tracks/293').then(function(player) {
    //     player.play();
    // });
    </script>
    <script src="javascripts/app.js"></script>
    <script>
    var script = document.createElement('script');
    script.onload = function() {
        var stats = new Stats();
        document.body.appendChild(stats.dom);
        requestAnimationFrame(function loop() {
            stats.update();
            requestAnimationFrame(loop)
        });
    };
    script.src = '//rawgit.com/mrdoob/stats.js/master/build/stats.min.js';
    document.head.appendChild(script);
    </script>

</body>

</html>
